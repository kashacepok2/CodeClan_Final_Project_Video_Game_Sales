---
title: "R Notebook"
output: html_notebook
---

```{r}
library(reticulate)
```

```{python}
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
import seaborn as sns

vg_ratings = pd.read_csv("vg_ratings.csv")
vg_sales = pd.read_csv("vg_sales.csv")
```

```{python}
plt.rcParams["figure.figsize"] = [7,5]
plt.rcParams["figure.dpi"] = 120
plt.rcParams["font.size"] = 9

sales_by_platform = (
  vg_sales
  .loc[vg_sales["platform"].isin(["Nintendo", "Microsoft Xbox", "Sony Playstation", "PC"])]
  .loc[vg_sales["year_of_release"] > 1999]
  .groupby("platform")
  .agg({"global_sales":"mean"})
)

plt.figure(1)
sns.barplot(data = sales_by_platform, x = sales_by_platform.index, y = "global_sales")
plt.legend().remove()
plt.xlabel("Platform")
plt.ylabel("Average Global Sales (millions)")
plt.title("Mean Average Sales of Games per platform")
plt.show()

```

```{python}
plt.close()

scores_by_platform = (
  vg_ratings
  .loc[vg_ratings["platform"].isin(["Nintendo", "Microsoft Xbox", "Sony Playstation", "PC"])]
)

plt.figure(2)
sns.barplot(data = scores_by_platform, x = "platform", y = "score", hue = "critic_or_user")
plt.xlabel("Platform")
plt.ylabel("Score")
plt.title("Average Critic and User Ratings per Platform")

plt.show()
```

```{python}
plt.close()

sales_by_genre = (
  vg_sales
  .loc[vg_sales["year_of_release"] > 1999]
  .groupby("genre")
  .agg({"global_sales":"mean"})
)

plt.figure(3)
sns.barplot(data = sales_by_genre, x = sales_by_genre.index, y = "global_sales")
plt.legend().remove()
plt.xlabel("Genre")
plt.ylabel("Average Global Sales (millions)")
plt.title("Mean Average Sales of Games per Genre")
plt.xticks(rotation = 20)

plt.show()
```

```{python}
plt.close()

scores_by_genre = (
  vg_ratings
  .loc[vg_ratings["platform"].isin(["Nintendo", "Microsoft Xbox", "Sony Playstation", "PC"])]
)

plt.figure(4)
sns.barplot(data = scores_by_genre, x = "genre", y = "score", hue = "critic_or_user")

plt.show()
```

```{python}
plt.close()

sales_by_maturity = (
  vg_sales
  .loc[vg_sales["year_of_release"] > 1999]
  .loc[vg_sales["rating"] != "RP"]
  .groupby("rating")
  .agg({"global_sales":"mean"})
)

plt.figure(5)
sns.barplot(data = sales_by_maturity, x = sales_by_maturity.index, y = "global_sales")
plt.legend().remove()
plt.xlabel("Maturity Rating")
plt.ylabel("Average Global Sales (millions)")
plt.title("Average Global Sales of Games per Maturity Rating")

plt.show()
```

```{python}
plt.close()

year_sales = (
  vg_sales[["genre", "year_of_release", "global_sales"]]
  .groupby(["year_of_release"])
  .agg({"global_sales":"sum"})
  .reset_index()
  )
  
year_sales_genre = (
  vg_sales[["genre", "year_of_release", "global_sales"]]
  .groupby(["genre", "year_of_release"])
  .agg({"global_sales":"sum"})
  .reset_index()
  )

prop_year_sales = year_sales_genre.merge(year_sales, how = "inner", on = "year_of_release")
prop_year_sales.loc[:, "proportion_sales"] = prop_year_sales.global_sales_x / prop_year_sales.global_sales_y
  
  
plt.figure(6)
ax = plt.figure(7).add_subplot(111)
sns.histplot(prop_year_sales, x = "year_of_release", hue = "genre", weights = "proportion_sales", multiple = "stack", bins = 40)
plt.xlabel("Year of Release")
plt.ylabel("Proportion of Sales")
plt.title("Proportion of Game Sales by Genre over Time")
ax.legend(loc='center left', bbox_to_anchor=(1, 0.5))
plt.show()
```

